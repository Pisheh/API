name: Node.js Deploy

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  create_API_docs:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v3.1.4
      with:
        # Version range or exact version of a Python version to use, using SemVer's version range syntax.
        python-version: 3.10.6
        cache: 'pip' # caching pip dependencies
    - run: pip install -r requirements.txt
    - run: python -c "from json import dump; from app.app import app; dump(app.openapi(),open('api.json','w'))"
    
    - name: swagger ui
      # You may pin to the exact commit or the version.
      # uses: pjoc-team/swagger-ui-action@7e646ed552cf7e47c4cf92ca39db364826623dad
      uses: pjoc-team/swagger-ui-action@v0.0.2
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        deploy_key: ${{secrets.ACTIONS_DEPLOY_KEY}}
        publish_dir: swagger-ui
